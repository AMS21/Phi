name: CMake

on:
  push:
    paths:
      # Workflow file itself
      - '.github/workflows/CMake.yml'
      # CMake files
      - '**.cmake'
      - '**.txt'
      # Script files
      - '**.sh'
    branches-ignore:
      - 'dependabot/**'
  pull_request:
    branches:
      - main
      - develop
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  configure:
    runs-on: 'ubuntu-22.04'
    container: 'ams21/cmake:${{ matrix.version }}'

    strategy:
      fail-fast: false

      matrix:
        version:
          # CMake 3.29.x
          - "3.29.0"

          # CMake 3.28.x
          - "3.28.4"
          - "3.28.3"
          - "3.28.2"
          - "3.28.1"
          - "3.28.0"

          # CMake 3.27.x
          - "3.27.9"
          - "3.27.8"
          - "3.27.7"
          - "3.27.6"
          - "3.27.5"
          - "3.27.4"
          - "3.27.3"
          - "3.27.2"
          - "3.27.1"
          - "3.27.0"

          # CMake 3.26.x
          - "3.26.6"
          - "3.26.5"
          - "3.26.4"
          - "3.26.3"
          - "3.26.2"
          - "3.26.1"
          - "3.26.0"

          # CMake 3.25.x
          - "3.25.3"
          - "3.25.2"
          - "3.25.1"
          - "3.25.0"

          # CMake 3.24.x
          - "3.24.4"
          - "3.24.3"
          - "3.24.2"
          - "3.24.1"
          - "3.24.0"

          # CMake 3.23.x
          - "3.23.5"
          - "3.23.4"
          - "3.23.3"
          - "3.23.2"
          - "3.23.1"
          - "3.23.0"

          # CMake 3.22.x
          - "3.22.6"
          - "3.22.5"
          - "3.22.4"
          - "3.22.3"
          - "3.22.2"
          - "3.22.1"
          - "3.22.0"

          # CMake 3.21.x
          - "3.21.7"
          - "3.21.6"
          - "3.21.5"
          - "3.21.4"
          - "3.21.3"
          - "3.21.2"
          - "3.21.1"
          - "3.21.0"

          # CMake 3.20.x
          - "3.20.6"
          - "3.20.5"
          - "3.20.4"
          - "3.20.3"
          - "3.20.2"
          - "3.20.1"
          - "3.20.0"

          # CMake 3.19.x
          - "3.19.8"
          - "3.19.7"
          - "3.19.6"
          - "3.19.5"
          - "3.19.4"
          - "3.19.3"
          - "3.19.2"
          - "3.19.1"
          - "3.19.0"

          # CMake 3.18.x
          - "3.18.6"
          - "3.18.5"
          - "3.18.4"
          - "3.18.3"
          - "3.18.2"
          - "3.18.1"
          - "3.18.0"

          # CMake 3.17.x
          - "3.17.5"
          - "3.17.4"
          - "3.17.3"
          - "3.17.2"
          - "3.17.1"
          - "3.17.0"

          # CMake 3.16.x
          - "3.16.9"
          - "3.16.8"
          - "3.16.7"
          - "3.16.6"
          - "3.16.5"
          - "3.16.4"
          - "3.16.3"
          - "3.16.2"
          - "3.16.1"
          - "3.16.0"

          # CMake 3.15.x
          - "3.15.7"
          - "3.15.6"
          - "3.15.5"
          - "3.15.4"
          - "3.15.3"
          - "3.15.2"
          - "3.15.1"
          - "3.15.0"

          # CMake 3.14.x
          - "3.14.7"
          - "3.14.6"
          - "3.14.5"
          - "3.14.4"
          - "3.14.3"
          - "3.14.2"
          - "3.14.1"
          - "3.14.0"

          # CMake 3.13.x
          - "3.13.5"
          - "3.13.4"
          - "3.13.3"
          - "3.13.2"
          - "3.13.1"
          - "3.13.0"

          # CMake 3.12.x
          - "3.12.4"
          - "3.12.3"
          - "3.12.2"
          - "3.12.1"
          - "3.12.0"

          # CMake 3.11.x
          - "3.11.4"
          - "3.11.3"
          - "3.11.2"
          - "3.11.1"
          - "3.11.0"

          # CMake 3.10.x
          - "3.10.3"
          - "3.10.2"
          - "3.10.1"
          - "3.10.0"

          # CMake 3.9.x
          - "3.9.6"
          - "3.9.5"
          - "3.9.4"
          - "3.9.3"
          - "3.9.2"
          - "3.9.1"
          - "3.9.0"

          # CMake 3.8.x
          - "3.8.2"
          - "3.8.1"
          - "3.8.0"

          # CMake 3.7.x
          - "3.7.2"
          - "3.7.1"
          - "3.7.0"

          # CMake 3.6.x
          - "3.6.3"
          - "3.6.2"
          - "3.6.1"
          - "3.6.0"

          # CMake 3.5.x
          - "3.5.2"
          - "3.5.1"
          - "3.5.0"

          # CMake 3.4.x
          - "3.4.3"
          - "3.4.2"
          - "3.4.1"
          - "3.4.0"

          # CMake 3.3.x
          - "3.3.2"
          - "3.3.1"
          - "3.3.0"

          # CMake 3.2.x
          - "3.2.3"
          - "3.2.2"
          - "3.2.1"
          - "3.2.0"

          # CMake 3.1.x
          - "3.1.3"
          - "3.1.2"
          - "3.1.1"
          - "3.1.0"

          # CMake 3.0.x
          - "3.0.2"
          - "3.0.1"
          - "3.0.0"

          # CMake 2.8.x
          - "2.8.12"

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Configure build directory
        run: |
          mkdir build -p
          cd build

          cmake ..
