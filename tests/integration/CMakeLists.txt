# Include all headers
file(GLOB_RECURSE PHI_HEADER_FILES ${PHI_BASE_DIR}/libs/*.hpp)

# Build file content
set(ALL_INCLUDE_FILE "IncludeAllFiles.cpp")
set(FILE_CONTENT
    "// DO NOT MODIFY THIS FILES CONTENTS IT'S AUTOMATICALLY GENERATED BY CMAKE DURING BUILDS\n")

foreach(file ${PHI_HEADER_FILES})
  file(RELATIVE_PATH path ${PHI_BASE_DIR}/libs/PhiEngine/include ${file})
  string(APPEND FILE_CONTENT "#include <" ${path} ">\n")
endforeach()

string(APPEND FILE_CONTENT "\nint main() {}\n")

# Generate File
file(
  GENERATE
  OUTPUT "${CMAKE_CURRENT_BINARY_DIR}/${ALL_INCLUDE_FILE}"
  CONTENT ${FILE_CONTENT})

# Add test
set(ALL_INCLUDE_NAME "PhiEngine_AllIncludes")

add_executable(${ALL_INCLUDE_NAME} "${CMAKE_CURRENT_BINARY_DIR}/${ALL_INCLUDE_FILE}")

target_link_libraries(${ALL_INCLUDE_NAME} PRIVATE Phi::ProjectOptions Phi::Engine)
enable_static_analyzers(${ALL_INCLUDE_NAME})

add_test(IncludeAll ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${ALL_INCLUDE_NAME})
